<!-- Navigation Module -->
<nav class="site-navigation" data-brand="{{ module.brand_style }}">
  <div class="nav-container">
    <div class="nav-wrapper">
      <!-- Logo -->
      <a href="/" class="nav-logo">
        {% if module.logo_image.src %}
          <img src="{{ module.logo_image.src }}" alt="{{ module.logo_image.alt }}" class="nav-logo-image">
        {% else %}
          <!-- Desktop Text Logo -->
          <span class="nav-logo-text nav-logo-desktop">
            <span class="nav-logo-bold">Cellcolabs</span>
            <span class="nav-logo-light">Clinical</span>
          </span>
          <!-- Mobile/Tablet Logo Image -->
          <img src="{{ get_asset_url('../assets/images/cellcolabsclinical-logo-mobile.png') }}" alt="Cellcolabs Clinical" class="nav-logo-image-mobile nav-logo-mobile">
        {% endif %}
      </a>

      <!-- Desktop Menu -->
      <div class="nav-menu-desktop">
        {% menu "main_navigation"
          id="main_navigation",
          site_map_name="main_navigation",
          overrideable=False,
          root_type="site_root",
          flyouts="true",
          max_levels="2",
          flow="horizontal",
          submenu_target="subnav",
          menu_class="nav-menu-list",
          item_class="nav-menu-item",
          link_class="nav-menu-link",
          active_class="nav-menu-item--active",
          child_ul_class="nav-submenu",
          child_li_class="nav-submenu-item",
          child_a_class="nav-submenu-link"
        %}
      </div>

      <!-- Mobile Menu Button -->
      <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
        <svg class="nav-toggle-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <circle cx="4" cy="4" r="1.5" fill="currentColor"/>
          <circle cx="12" cy="4" r="1.5" fill="currentColor"/>
          <circle cx="20" cy="4" r="1.5" fill="currentColor"/>
          <circle cx="4" cy="12" r="1.5" fill="currentColor"/>
          <circle cx="12" cy="12" r="1.5" fill="currentColor"/>
          <circle cx="20" cy="12" r="1.5" fill="currentColor"/>
          <circle cx="4" cy="20" r="1.5" fill="currentColor"/>
          <circle cx="12" cy="20" r="1.5" fill="currentColor"/>
          <circle cx="20" cy="20" r="1.5" fill="currentColor"/>
        </svg>
        <svg class="nav-toggle-close" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
          <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
        </svg>
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div class="nav-menu-mobile">
    <div class="nav-menu-mobile-wrapper">
      {% menu "main_navigation_mobile"
        id="main_navigation",
        site_map_name="main_navigation",
        overrideable=False,
        root_type="site_root",
        flyouts="false",
        max_levels="2",
        flow="vertical",
        menu_class="nav-mobile-list",
        item_class="nav-mobile-item",
        link_class="nav-mobile-link",
        active_class="nav-mobile-item--active",
        child_ul_class="nav-mobile-submenu",
        child_li_class="nav-mobile-submenu-item",
        child_a_class="nav-mobile-submenu-link"
      %}
    </div>
  </div>

  <!-- Mobile Divider -->
  <div class="nav-divider-mobile"></div>
</nav>

<style>
  /* Navigation Base Styles */
  .site-navigation {
    background-color: var(--color-bg-white);
    position: relative;
    z-index: 1000;
  }

  .nav-container {
    max-width: 1440px;
    margin: 0 auto;
    padding: 0 var(--container-padding-desktop);
  }

  .nav-wrapper {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-16) 0;
  }

  /* Logo Styles */
  .nav-logo {
    text-decoration: none;
    display: flex;
    align-items: center;
  }

  .nav-logo-text {
    font-size: 1rem;
    line-height: 1.5;
    color: var(--color-text-primary);
    white-space: nowrap;
    display: flex;
    align-items: center;
  }

  .nav-logo-bold {
    font-family: var(--font-body);
    font-weight: var(--font-weight-semibold);
  }

  .nav-logo-light {
    font-family: var(--font-body);
    font-weight: 300;
    margin-left: 0.25em;
  }

  .nav-logo-image {
    height: 32px;
    width: auto;
  }

  .nav-logo-image-mobile {
    height: 40px;
    width: auto;
    max-width: 58px;
  }

  /* Logo responsive display */
  .nav-logo-desktop {
    display: none;
  }

  .nav-logo-mobile {
    display: block;
  }

  /* Desktop Menu Styles */
  .nav-menu-desktop {
    display: none;
  }

  .nav-menu-list {
    display: flex;
    gap: var(--space-8);
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-menu-item {
    position: relative;
  }

  .nav-menu-link {
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: var(--font-weight-medium);
    line-height: 1rem;
    color: var(--color-text-primary);
    text-decoration: none;
    padding: var(--space-8) var(--space-16);
    display: block;
    transition: color 0.2s ease;
  }

  .nav-menu-link:hover {
    color: var(--color-text-link);
  }

  .nav-menu-item--active > .nav-menu-link {
    color: var(--color-text-link);
  }

  /* Submenu Styles */
  .nav-submenu {
    position: absolute;
    top: 100%;
    left: 0;
    min-width: 200px;
    background-color: var(--color-bg-white);
    box-shadow: var(--shadow-lg);
    border-radius: var(--radius-md);
    padding: var(--space-8) 0;
    opacity: 0;
    visibility: hidden;
    transform: translateY(-10px);
    transition: all 0.3s ease;
    list-style: none;
  }

  .nav-menu-item:hover > .nav-submenu {
    opacity: 1;
    visibility: visible;
    transform: translateY(0);
  }

  .nav-submenu-link {
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: var(--font-weight-regular);
    line-height: 1.2;
    color: var(--color-text-secondary);
    text-decoration: none;
    padding: var(--space-8) var(--space-24);
    display: block;
    transition: all 0.2s ease;
  }

  .nav-submenu-link:hover {
    color: var(--color-text-primary);
    background-color: var(--color-gray-900);
  }

  /* Mobile Menu Button */
  .nav-toggle {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 40px;
    height: 40px;
    background: none;
    border: none;
    cursor: pointer;
    color: var(--color-text-primary);
  }

  .nav-toggle-icon,
  .nav-toggle-close {
    width: 24px;
    height: 24px;
  }

  .nav-toggle-close {
    display: none;
  }

  .nav-toggle[aria-expanded="true"] .nav-toggle-icon {
    display: none;
  }

  .nav-toggle[aria-expanded="true"] .nav-toggle-close {
    display: block;
  }

  /* Mobile Menu */
  .nav-menu-mobile {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background-color: var(--color-bg-white);
    box-shadow: var(--shadow-lg);
    max-height: calc(100vh - 80px);
    overflow-y: auto;
  }

  .nav-menu-mobile.is-active {
    display: block;
  }

  .nav-menu-mobile-wrapper {
    padding: var(--space-24);
  }

  .nav-mobile-list {
    list-style: none;
    margin: 0;
    padding: 0;
  }

  .nav-mobile-link {
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: var(--font-weight-regular);
    line-height: 1.5;
    color: var(--color-text-primary);
    text-decoration: none;
    padding: var(--space-16) 0;
    display: block;
    border-bottom: 1px solid var(--color-gray-800);
    transition: color 0.2s ease;
  }

  .nav-mobile-link:hover {
    color: var(--color-text-link);
  }

  .nav-mobile-item--active > .nav-mobile-link {
    color: var(--color-text-link);
    font-weight: var(--font-weight-medium);
  }

  /* Mobile Submenu */
  .nav-mobile-submenu {
    list-style: none;
    margin: 0;
    padding: 0 0 0 var(--space-24);
  }

  .nav-mobile-submenu-link {
    font-family: var(--font-body);
    font-size: 0.875rem;
    font-weight: var(--font-weight-regular);
    line-height: 1.5;
    color: var(--color-text-secondary);
    text-decoration: none;
    padding: var(--space-8) 0;
    display: block;
  }

  /* Mobile Divider */
  .nav-divider-mobile {
    display: none;
    height: 1px;
    background-color: var(--color-divider-dark);
    opacity: 0.2;
  }

  /* Responsive Styles */
  @media (max-width: 767px) {
    .nav-container {
      padding: 0 var(--container-padding-mobile);
    }

    .nav-divider-mobile {
      display: block;
    }
  }

  @media (min-width: 768px) and (max-width: 1023px) {
    .nav-container {
      padding: 0 var(--container-padding-tablet);
    }

    .nav-divider-mobile {
      display: block;
    }
  }

  @media (min-width: 1024px) {
    .nav-container {
      padding: 0 var(--container-padding-desktop);
    }

    .nav-menu-desktop {
      display: block;
    }

    .nav-toggle {
      display: none;
    }

    .nav-menu-mobile {
      display: none !important;
    }

    .nav-divider-mobile {
      display: none;
    }

    /* 1024-1440px: Still show image logo */
    .nav-logo-desktop {
      display: none;
    }

    .nav-logo-mobile {
      display: block;
    }
  }

  @media (min-width: 1440px) {
    .nav-container {
      padding: 0 152px;
    }

    /* 1440px+: Show text logo, hide image logo */
    .nav-logo-desktop {
      display: inline;
    }

    .nav-logo-mobile {
      display: none;
    }
  }
</style>

<script>
  (function() {
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMobile = document.querySelector('.nav-menu-mobile');

    if (navToggle && navMobile) {
      navToggle.addEventListener('click', function() {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !isExpanded);
        navMobile.classList.toggle('is-active');
        document.body.style.overflow = !isExpanded ? 'hidden' : '';
      });
    }

    // Close mobile menu on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && navMobile && navMobile.classList.contains('is-active')) {
        navToggle.setAttribute('aria-expanded', 'false');
        navMobile.classList.remove('is-active');
        document.body.style.overflow = '';
      }
    });

    // Close mobile menu on click outside
    document.addEventListener('click', function(e) {
      if (navMobile && navMobile.classList.contains('is-active')) {
        if (!e.target.closest('.site-navigation')) {
          navToggle.setAttribute('aria-expanded', 'false');
          navMobile.classList.remove('is-active');
          document.body.style.overflow = '';
        }
      }
    });
  })();
</script>