<!--
  templateType: global_partial
  label: Cellcolabs Clinical Header
-->
{# Retrieve translations for the template #}
{% set template_translations = load_translations('../_locales', html_lang, 'en') %}

<header class="header site-header cellcolabs-clinical-header">

  {# The link below is used for a navigation skipper which allows users navigating the site with their keyboard to skip over the site navigation #}
  <a href="#main-content" class="header__skip">{{ template_translations.partial_header_skip_to_content.message }}</a>

  <!-- Navigation -->
  <nav class="site-navigation" data-brand="cellcolabsclinical">
    <div class="nav-container">
      <div class="nav-wrapper">
        <!-- Logo -->
        <a href="/" class="nav-logo">
          <!-- Desktop Text Logo -->
          <span class="nav-logo-text nav-logo-desktop">
            <span class="nav-logo-bold">Cellcolabs</span>
            <span class="nav-logo-light">Clinical</span>
          </span>
          <!-- Mobile/Tablet Logo Image -->
          <img src="https://144549987.fs1.hubspotusercontent-eu1.net/hubfs/144549987/Cellcolabs%20Clinical%20Logo.png" alt="Cellcolabs Clinical" class="nav-logo-image-mobile nav-logo-mobile">
        </a>

        <!-- Desktop Menu -->
        <div class="nav-menu-desktop">
          {% menu "main_navigation"
            id="main_navigation",
            site_map_name="main_navigation",
            overrideable=False,
            root_type="site_root",
            flyouts="true",
            max_levels="2",
            flow="horizontal",
            menu_class="nav-menu-list",
            item_class="nav-menu-item",
            link_class="nav-menu-link",
            active_class="nav-menu-item--active",
            child_ul_class="nav-submenu",
            child_li_class="nav-submenu-item",
            child_a_class="nav-submenu-link"
          %}
        </div>

        <!-- Mobile Menu Button -->
        <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false">
          <!-- Dotted Grid Icon (3x3 dots like your React component) -->
          <div class="nav-toggle-dots">
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
            <span class="dot"></span>
          </div>
          <!-- Close icon -->
          <svg class="nav-toggle-close" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div class="nav-menu-mobile">
      <div class="nav-menu-mobile-wrapper">
        {% menu "main_navigation_mobile"
          id="main_navigation",
          site_map_name="main_navigation",
          overrideable=False,
          root_type="site_root",
          flyouts="false",
          max_levels="2",
          flow="vertical",
          menu_class="nav-mobile-list",
          item_class="nav-mobile-item",
          link_class="nav-mobile-link",
          active_class="nav-mobile-item--active",
          child_ul_class="nav-mobile-submenu",
          child_li_class="nav-mobile-submenu-item",
          child_a_class="nav-mobile-submenu-link"
        %}
      </div>
    </div>
  </nav>

</header>

<script>
  // Navigation functionality for the child theme header
  (function() {
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMobile = document.querySelector('.nav-menu-mobile');
    const header = document.querySelector('.site-header');

    if (navToggle && navMobile) {
      navToggle.addEventListener('click', function() {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !isExpanded);
        navMobile.classList.toggle('is-active');
        document.body.style.overflow = !isExpanded ? 'hidden' : '';
      });
    }

    // Scroll effects
    if (header) {
      function handleScroll() {
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

        if (currentScroll > 10) {
          header.classList.add('is-scrolled');
        } else {
          header.classList.remove('is-scrolled');
        }
      }

      // Throttled scroll listener
      let scrollTimer;
      window.addEventListener('scroll', function() {
        if (scrollTimer) {
          clearTimeout(scrollTimer);
        }
        scrollTimer = setTimeout(handleScroll, 10);
      }, { passive: true });

      handleScroll();
    }

    // Close mobile menu on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && navMobile && navMobile.classList.contains('is-active')) {
        navToggle.setAttribute('aria-expanded', 'false');
        navMobile.classList.remove('is-active');
        document.body.style.overflow = '';
      }
    });

    // Close mobile menu on click outside
    document.addEventListener('click', function(e) {
      if (navMobile && navMobile.classList.contains('is-active')) {
        if (!e.target.closest('.site-navigation')) {
          navToggle.setAttribute('aria-expanded', 'false');
          navMobile.classList.remove('is-active');
          document.body.style.overflow = '';
        }
      }
    });
  })();
</script>