<!--
  templateType: global_partial
  label: Dual Brand Header v3
  Updated: 2025-09-25 v3.0 - CACHE BUSTER
-->
{# Retrieve translations for the template #}
{% set template_translations = load_translations('../_locales', html_lang, 'en') %}

{# Domain-based brand detection #}
{% set current_brand = "cellcolabsclinical" %}
{% if request.domain == "cellcolabs.com" %}
  {% set current_brand = "cellcolabs" %}
{% elif request.domain == "cellcolabsclinical.com" %}
  {% set current_brand = "cellcolabsclinical" %}
{% endif %}

<header class="header site-header" data-brand="{{ current_brand }}">

  {# Brand switcher for editor testing (only visible in edit mode) #}
  <div id="brand-switcher" style="position: fixed; top: 10px; right: 10px; z-index: 99999; background: white; padding: 10px; border: 1px solid #ccc; border-radius: 4px; box-shadow: 0 2px 8px rgba(0,0,0,0.15); font-family: Inter, sans-serif; font-size: 12px;">
    <label style="display: block; margin-bottom: 5px; font-weight: 600;">Preview Brand:</label>
    <select id="brand-selector" style="width: 100%; padding: 4px; border: 1px solid #ccc; border-radius: 3px;">
      <option value="cellcolabsclinical">Clinical (Blue)</option>
      <option value="cellcolabs">Cellcolabs (Green)</option>
    </select>
  </div>

  {# The link below is used for a navigation skipper which allows users navigating the site with their keyboard to skip over the site navigation #}
  <a href="#main-content" class="header__skip">{{ template_translations.partial_header_skip_to_content.message }}</a>

  <!-- Navigation -->\
  <nav class="site-navigation" data-brand="{{ current_brand }}" style="background-color: #ffffff !important; position: relative !important; z-index: 1000 !important;">
    <div class="nav-container" style="max-width: 1460px !important; margin: 0 auto !important; padding: 0 24px !important;">
      <div class="nav-wrapper" style="display: flex !important; justify-content: space-between !important; align-items: center !important; padding: 16px 0 !important; min-height: 72px !important;">

        <!-- Logo - Image Only Per Figma -->
        <a href="/" class="nav-logo" style="text-decoration: none !important; display: flex !important; align-items: center !important;">
          {% if current_brand == "cellcolabs" %}
            <img src="https://144549987.fs1.hubspotusercontent-eu1.net/hubfs/144549987/Cellcolabs%20Logo.png" alt="Cellcolabs" style="height: 40px !important; width: 58px !important; object-fit: contain !important; display: block !important;">
          {% else %}
            <img src="https://144549987.fs1.hubspotusercontent-eu1.net/hubfs/144549987/Cellcolabs%20Clinical%20Logo.png" alt="Cellcolabs Clinical" style="height: 40px !important; width: 58px !important; object-fit: contain !important; display: block !important;">
          {% endif %}
        </a>

        <!-- Desktop Menu -->
        <div class="nav-menu-desktop" style="display: none !important;">
          <div style="display: flex !important; align-items: center !important;">
            {% menu "main_navigation"
              id="main_navigation",
              site_map_name="main_navigation",
              overrideable=False,
              root_type="site_root",
              flyouts="true",
              max_levels="2",
              flow="horizontal",
              menu_class="nav-menu-list",
              item_class="nav-menu-item",
              link_class="nav-menu-link",
              active_class="nav-menu-item--active",
              child_ul_class="nav-submenu",
              child_li_class="nav-submenu-item",
              child_a_class="nav-submenu-link"
            %}
          </div>
        </div>

        <!-- Mobile Menu Button - 6 dots (2x3 grid) per Figma -->
        <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false" style="display: flex !important; align-items: center !important; justify-content: center !important; width: 48px !important; height: 48px !important; background: none !important; border: none !important; cursor: pointer !important; color: #161616 !important;">
          <svg class="nav-toggle-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="8" cy="6" r="1.5" fill="currentColor"/>
            <circle cx="16" cy="6" r="1.5" fill="currentColor"/>
            <circle cx="8" cy="12" r="1.5" fill="currentColor"/>
            <circle cx="16" cy="12" r="1.5" fill="currentColor"/>
            <circle cx="8" cy="18" r="1.5" fill="currentColor"/>
            <circle cx="16" cy="18" r="1.5" fill="currentColor"/>
          </svg>
          <svg class="nav-toggle-close" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none !important;">
            <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div class="nav-menu-mobile" style="display: none !important; position: absolute !important; top: 100% !important; left: 0 !important; right: 0 !important; background-color: #ffffff !important; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important; max-height: calc(100vh - 80px) !important; overflow-y: auto !important; z-index: 999 !important;">
      <div style="padding: 24px !important;">
        {% menu "main_navigation_mobile"
          id="main_navigation",
          site_map_name="main_navigation",
          overrideable=False,
          root_type="site_root",
          flyouts="false",
          max_levels="2",
          flow="vertical",
          menu_class="nav-mobile-list",
          item_class="nav-mobile-item",
          link_class="nav-mobile-link",
          active_class="nav-mobile-item--active",
          child_ul_class="nav-mobile-submenu",
          child_li_class="nav-mobile-submenu-item",
          child_a_class="nav-mobile-submenu-link"
        %}
      </div>
    </div>
  </nav>

</header>

<!-- Inline Styles - MAXIMUM OVERRIDE POWER -->
<style>
  /* Global font import */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;450;500;550;600;650;700;750;800;900&display=swap');

  /* DESKTOP MENU - FIGMA EXACT SPECIFICATIONS */
  .header .nav-menu-desktop .hs-menu-wrapper > ul {
    display: flex !important;
    gap: 8px !important;
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
    align-items: center !important;
  }

  .header .nav-menu-desktop .hs-menu-item {
    position: relative !important;
    margin: 0 !important;
  }

  /* NUCLEAR MENU ITEM OVERRIDE */
  html body .header .nav-menu-desktop .hs-menu-wrapper > ul > li.hs-menu-item > a,
  html body .header .nav-menu-desktop .hs-menu-wrapper > ul > li.hs-menu-item > a[role="menuitem"],
  html body .header .nav-menu-desktop .hs-menu-item > a,
  html body .header .site-navigation .nav-menu-desktop .hs-menu-wrapper .hs-menu-item a {
    font-family: 'Inter', sans-serif !important;
    font-size: 16px !important;
    font-weight: 500 !important;
    line-height: 1 !important;
    color: #161616 !important;
    text-decoration: none !important;
    padding: 12px 16px !important;
    display: block !important;
    transition: color 0.2s ease !important;
    background: transparent !important;
    border: none !important;
  }

  /* HOVER OVERRIDE */
  html body .header .nav-menu-desktop .hs-menu-wrapper > ul > li.hs-menu-item > a:hover,
  html body .header .nav-menu-desktop .hs-menu-item > a:hover,
  html body .header .site-navigation .nav-menu-desktop .hs-menu-wrapper .hs-menu-item a:hover {
    color: #4f65be !important;
  }

  /* MOBILE MENU OVERRIDES */
  html body .header .nav-menu-mobile .hs-menu-wrapper > ul {
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
  }

  html body .header .nav-menu-mobile .hs-menu-item > a {
    font-family: 'Inter', sans-serif !important;
    font-size: 16px !important;
    font-weight: 450 !important;
    line-height: 1.5 !important;
    color: #161616 !important;
    text-decoration: none !important;
    padding: 16px 0 !important;
    display: block !important;
    border-bottom: 1px solid #c6c6c6 !important;
    transition: color 0.2s ease !important;
  }

  html body .header .nav-menu-mobile .hs-menu-item > a:hover {
    color: #4f65be !important;
  }

  /* Mobile toggle states */
  .header .nav-toggle[aria-expanded="true"] .nav-toggle-icon {
    display: none !important;
  }

  .header .nav-toggle[aria-expanded="true"] .nav-toggle-close {
    display: block !important;
  }

  .header .nav-menu-mobile.is-active {
    display: block !important;
  }

  /* Responsive Design - FIGMA BREAKPOINTS */
  @media (max-width: 767px) {
    .header .nav-container {
      padding: 6px 16px !important;
    }
    .header .nav-wrapper {
      padding: 0 !important;
      min-height: 52px !important;
    }
  }

  @media (min-width: 768px) and (max-width: 1023px) {
    .header .nav-container {
      padding: 6px 16px !important;
    }
    .header .nav-wrapper {
      padding: 0 !important;
      min-height: 52px !important;
    }
  }

  @media (min-width: 1024px) {
    .header .nav-container {
      padding: 0 24px !important;
    }
    .header .nav-wrapper {
      padding: 16px 0 !important;
      min-height: 72px !important;
    }
    .header .nav-menu-desktop {
      display: block !important;
    }
    .header .nav-toggle {
      display: none !important;
    }
    .header .nav-menu-mobile {
      display: none !important;
    }
  }

  @media (min-width: 1460px) {
    .header .nav-container {
      padding: 0 24px !important;
    }
  }
</style>

<script>
  // Navigation functionality for the child theme header
  (function() {
    // Mobile menu toggle
    const navToggle = document.querySelector('.nav-toggle');
    const navMobile = document.querySelector('.nav-menu-mobile');
    const header = document.querySelector('.site-header');

    if (navToggle && navMobile) {
      navToggle.addEventListener('click', function() {
        const isExpanded = this.getAttribute('aria-expanded') === 'true';
        this.setAttribute('aria-expanded', !isExpanded);
        navMobile.classList.toggle('is-active');
        document.body.style.overflow = !isExpanded ? 'hidden' : '';
      });
    }

    // Scroll effects
    if (header) {
      function handleScroll() {
        const currentScroll = window.pageYOffset || document.documentElement.scrollTop;

        if (currentScroll > 10) {
          header.classList.add('is-scrolled');
        } else {
          header.classList.remove('is-scrolled');
        }
      }

      // Throttled scroll listener
      let scrollTimer;
      window.addEventListener('scroll', function() {
        if (scrollTimer) {
          clearTimeout(scrollTimer);
        }
        scrollTimer = setTimeout(handleScroll, 10);
      }, { passive: true });

      handleScroll();
    }

    // Close mobile menu on escape key
    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && navMobile && navMobile.classList.contains('is-active')) {
        navToggle.setAttribute('aria-expanded', 'false');
        navMobile.classList.remove('is-active');
        document.body.style.overflow = '';
      }
    });

    // Close mobile menu on click outside
    document.addEventListener('click', function(e) {
      if (navMobile && navMobile.classList.contains('is-active')) {
        if (!e.target.closest('.site-navigation')) {
          navToggle.setAttribute('aria-expanded', 'false');
          navMobile.classList.remove('is-active');
          document.body.style.overflow = '';
        }
      }
    });

    // Brand switcher functionality
    const brandSwitcher = document.getElementById('brand-switcher');
    const brandSelector = document.getElementById('brand-selector');

    if (brandSwitcher && brandSelector) {
      // Set current brand in selector
      brandSelector.value = '{{ current_brand }}';

      // Handle brand switching
      brandSelector.addEventListener('change', function() {
        const selectedBrand = this.value;

        // Update all elements with data-brand attribute
        document.querySelectorAll('[data-brand]').forEach(el => {
          el.setAttribute('data-brand', selectedBrand);
        });

        // Update body class for global brand switching
        document.body.setAttribute('data-brand', selectedBrand);

        // Update header and nav specifically
        const header = document.querySelector('.site-header');
        const nav = document.querySelector('.site-navigation');
        if (header) header.setAttribute('data-brand', selectedBrand);
        if (nav) nav.setAttribute('data-brand', selectedBrand);

        console.log('Brand switched to:', selectedBrand);
      });

      // Hide brand switcher on published sites (only show in editor)
      if (window.location.hostname !== 'preview.hs-sites.com' &&
          !window.location.hostname.includes('hubspot')) {
        brandSwitcher.style.display = 'none';
      }
    }
  })();
</script>