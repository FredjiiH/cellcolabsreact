<!--
  templateType: module
  label: Header - Cellcolabs Clinical
  isAvailableForNewContent: false
-->
{# Retrieve translations for the template #}
{% set template_translations = load_translations('../../templates/_locales', html_lang, 'en') %}

{# Load main navigation menu #}
{% set main_menu = menu("main_navigation_clinical") %}

<header class="header site-header" data-brand="cellcolabsclinical">

  {# The link below is used for a navigation skipper which allows users navigating the site with their keyboard to skip over the site navigation #}
  <a href="#main-content" class="header__skip">{{ template_translations.partial_header_skip_to_content.message }}</a>

  <!-- Navigation -->
  <nav class="site-navigation" data-brand="cellcolabsclinical" style="background-color: #ffffff !important;">
    <div class="nav-container" style="max-width: 1460px !important; margin: 0 auto !important; padding: 0 24px !important;">
      <div class="nav-wrapper" style="display: flex !important; justify-content: space-between !important; align-items: center !important; padding: 16px 0 !important; min-height: 72px !important; position: relative !important;">

        <!-- Logo - Image Only Per Figma -->
        <a href="/" class="nav-logo" style="text-decoration: none !important; display: flex !important; align-items: center !important;">
          <img src="https://144549987.fs1.hubspotusercontent-eu1.net/hubfs/144549987/Cellcolabs%20Clinical%20Logo.png" alt="Cellcolabs Clinical" style="height: 40px !important; width: 58px !important; object-fit: contain !important; display: block !important;">
        </a>

        <!-- Desktop Menu -->
        <div class="nav-menu-desktop">
          <ul class="nav-menu-list">
            {% for item in main_menu %}
              {# Only show top-level items with labels (skip root and submenu items) #}
              {% if item.label and item.level == 1 %}
              <li class="nav-menu-item{% if item.children %} has-submenu{% endif %}{% if item.activeBranch %} nav-menu-item--active{% endif %}">
                <a href="{{ item.url }}" class="nav-menu-link">
                  {{ item.label }}
                  {% if item.children %}
                    <svg class="nav-chevron-icon" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                      <path d="M2 2L6 6L10 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                  {% endif %}
                </a>

                {% if item.children %}
                  <ul class="nav-submenu">
                    {% for child in item.children %}
                      <li class="nav-submenu-item{% if child.activeBranch %} nav-submenu-item--active{% endif %}">
                        <a href="{{ child.url }}" class="nav-submenu-link">{{ child.label }}</a>
                      </li>
                    {% endfor %}
                  </ul>
                {% endif %}
              </li>
              {% endif %}
            {% endfor %}
          </ul>
        </div>

        <!-- Mobile Menu Button - 6 dots (2x3 grid) per Figma -->
        <button class="nav-toggle" aria-label="Toggle navigation" aria-expanded="false" style="display: flex !important; align-items: center !important; justify-content: center !important; width: 48px !important; height: 48px !important; background: none !important; border: none !important; cursor: pointer !important; color: #161616 !important; position: absolute !important; right: 24px !important; top: 50% !important; transform: translateY(-50%) !important; z-index: 2147483647 !important;">
          <svg class="nav-toggle-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
            <circle cx="6" cy="8" r="1.5" fill="currentColor"/>
            <circle cx="12" cy="8" r="1.5" fill="currentColor"/>
            <circle cx="18" cy="8" r="1.5" fill="currentColor"/>
            <circle cx="6" cy="16" r="1.5" fill="currentColor"/>
            <circle cx="12" cy="16" r="1.5" fill="currentColor"/>
            <circle cx="18" cy="16" r="1.5" fill="currentColor"/>
          </svg>
          <svg class="nav-toggle-close" width="24" height="24" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" style="display: none !important;">
            <path d="M18 6L6 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
            <path d="M6 6L18 18" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
          </svg>
        </button>
      </div>
    </div>

    <!-- Mobile Menu -->
    <div class="nav-menu-mobile" style="position: absolute !important; top: 100% !important; left: 0 !important; right: 0 !important; background-color: #ffffff !important; box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important; max-height: calc(100vh - 80px) !important; overflow-y: auto !important; z-index: 999998 !important;">
      <div style="padding: 24px !important;">
        <ul class="nav-mobile-list">
          {% for item in main_menu %}
            {# Only show top-level items with labels (skip root and submenu items) #}
            {% if item.label and item.level == 1 %}
            <li class="nav-mobile-item{% if item.children %} has-submenu{% endif %}{% if item.activeBranch %} nav-mobile-item--active{% endif %}">
              <a href="{{ item.url }}" class="nav-mobile-link{% if item.children %} has-children{% endif %}">
                {{ item.label }}
                {% if item.children %}
                  <svg class="nav-chevron-icon" viewBox="0 0 12 8" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M2 2L6 6L10 2" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                  </svg>
                {% endif %}
              </a>

              {% if item.children %}
                <ul class="nav-mobile-submenu">
                  {% for child in item.children %}
                    <li class="nav-mobile-submenu-item{% if child.activeBranch %} nav-mobile-submenu-item--active{% endif %}">
                      <a href="{{ child.url }}" class="nav-mobile-submenu-link">{{ child.label }}</a>
                    </li>
                  {% endfor %}
                </ul>
              {% endif %}
            </li>
            {% endif %}
          {% endfor %}
        </ul>
      </div>
    </div>
  </nav>

</header>

<style>
  /* Global font import */
  @import url('https://fonts.googleapis.com/css2?family=Inter:wght@100;200;300;400;450;500;550;600;650;700;750;800;900&display=swap');

  /* ==============================================
     CSS CUSTOM PROPERTY OVERRIDE SYSTEM
     ============================================== */
  /* Set header link color override */
  .header {
    --link-color: var(--color-text-primary);  /* Black for navigation links */
  }

  /* ==============================================
     STICKY HEADER
     ============================================== */
  .hs_cos_wrapper_type_module:has(.header.site-header) {
    position: -webkit-sticky !important;
    position: sticky !important;
    top: 0 !important;
    z-index: 999999 !important;
  }

  .header.site-header {
    background-color: #ffffff !important;
  }

  /* ==============================================
     DESKTOP MENU - HORIZONTAL LAYOUT
     ============================================== */
  .header .nav-menu-desktop .nav-menu-list {
    display: flex !important;
    gap: 8px !important;
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
    align-items: center !important;
  }

  .header .nav-menu-item {
    position: relative !important;
    margin: 0 !important;
  }

  /* Desktop menu links - use --link-color custom property */
  .header .nav-menu-desktop .nav-menu-link {
    font-family: var(--font-body, 'Inter', sans-serif) !important;
    font-size: 16px !important;
    font-weight: var(--font-weight-medium, 500) !important;
    line-height: 1 !important;
    color: var(--link-color) !important;
    text-decoration: none !important;
    padding: 12px 16px !important;
    display: flex !important;
    align-items: center !important;
    gap: 4px !important;
    transition: color 0.2s ease !important;
    background: transparent !important;
    border: none !important;
  }

  /* Desktop menu link hover - use brand color variable */
  .header .nav-menu-desktop .nav-menu-link:hover {
    color: var(--color-brand-500, #4f65be) !important;
  }

  /* Submenu chevron icon */
  .nav-chevron-icon {
    width: 12px;
    height: 8px;
    display: inline-flex;
    align-items: center;
    justify-content: center;
    margin-left: 4px;
    margin-top: 0;
    margin-bottom: 0;
    transition: transform 0.2s ease;
    flex-shrink: 0;
    align-self: center;
    vertical-align: middle;
  }

  .nav-chevron-icon svg {
    width: 100%;
    height: 100%;
    display: block;
    vertical-align: middle;
  }

  /* Rotate chevron when submenu is open */
  .nav-menu-item.has-submenu.submenu-open .nav-chevron-icon,
  .nav-mobile-item.has-submenu.submenu-open .nav-chevron-icon {
    transform: rotate(180deg);
  }

  /* Rotate chevron on desktop hover */
  .header .nav-menu-desktop .nav-menu-item.has-submenu:hover > .nav-menu-link .nav-chevron-icon {
    transform: rotate(180deg);
  }

  /* Desktop submenu positioning */
  .header .nav-menu-desktop .nav-submenu {
    position: absolute !important;
    top: 100% !important;
    left: 0 !important;
    background: #ffffff !important;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
    border-radius: 8px !important;
    padding: 8px 0 !important;
    margin: 0 !important;
    min-width: 200px !important;
    display: none !important;
    list-style: none !important;
    z-index: 10000 !important;
  }

  /* Show submenu on hover */
  .header .nav-menu-desktop .nav-menu-item:hover > .nav-submenu,
  .header .nav-menu-desktop .nav-menu-item.submenu-open > .nav-submenu {
    display: block !important;
  }

  /* Submenu items */
  .header .nav-submenu-item {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Submenu links - use --link-color */
  .header .nav-menu-desktop .nav-submenu-link {
    font-family: var(--font-body, 'Inter', sans-serif) !important;
    font-size: 14px !important;
    font-weight: var(--font-weight-regular, 450) !important;
    line-height: 1.5 !important;
    color: var(--link-color) !important;
    text-decoration: none !important;
    padding: 8px 16px !important;
    display: block !important;
    transition: background-color 0.2s ease, color 0.2s ease !important;
    background: transparent !important;
    border: none !important;
  }

  /* Submenu link hover */
  .header .nav-menu-desktop .nav-submenu-link:hover {
    background-color: #f4f4f4 !important;
    color: var(--color-brand-500, #4f65be) !important;
  }

  /* ==============================================
     MOBILE MENU - VERTICAL LAYOUT
     ============================================== */
  .header .nav-menu-mobile .nav-mobile-list {
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
    display: block !important;
  }

  .header .nav-mobile-item {
    position: relative !important;
    margin: 0 !important;
  }

  /* Mobile menu links - use --link-color */
  .header .nav-menu-mobile .nav-mobile-link {
    font-family: var(--font-body, 'Inter', sans-serif) !important;
    font-size: 16px !important;
    font-weight: var(--font-weight-regular, 450) !important;
    line-height: 1.5 !important;
    color: var(--link-color) !important;
    text-decoration: none !important;
    padding: 16px 24px !important;
    display: flex !important;
    align-items: center !important;
    justify-content: space-between !important;
    border-bottom: 1px solid #c6c6c6 !important;
    transition: color 0.2s ease !important;
    background: transparent !important;
  }

  /* Mobile menu link hover */
  .header .nav-menu-mobile .nav-mobile-link:hover {
    color: var(--color-brand-500, #4f65be) !important;
  }

  /* Last menu item - no bottom border */
  .header .nav-menu-mobile .nav-mobile-item:last-child > .nav-mobile-link {
    border-bottom: none !important;
  }

  /* Mobile submenu - collapsed by default */
  .header .nav-menu-mobile .nav-mobile-submenu {
    list-style: none !important;
    margin: 0 !important;
    padding: 0 !important;
    max-height: 0 !important;
    overflow: hidden !important;
    transition: max-height 0.3s ease !important;
    background: #f4f4f4 !important;
  }

  /* Mobile submenu - expanded state */
  .header .nav-menu-mobile .nav-mobile-item.submenu-open .nav-mobile-submenu {
    max-height: 500px !important;
  }

  /* Mobile submenu items */
  .header .nav-mobile-submenu-item {
    margin: 0 !important;
    padding: 0 !important;
  }

  /* Mobile submenu links - use --link-color */
  .header .nav-menu-mobile .nav-mobile-submenu-link {
    font-family: var(--font-body, 'Inter', sans-serif) !important;
    font-size: 14px !important;
    font-weight: var(--font-weight-regular, 450) !important;
    line-height: 1.5 !important;
    color: var(--link-color) !important;
    text-decoration: none !important;
    padding: 12px 24px 12px 40px !important;
    display: block !important;
    border-bottom: 1px solid #e0e0e0 !important;
    transition: color 0.2s ease !important;
    background: transparent !important;
  }

  /* Mobile submenu link hover */
  .header .nav-menu-mobile .nav-mobile-submenu-link:hover {
    color: var(--color-brand-500, #4f65be) !important;
  }

  /* ==============================================
     MOBILE TOGGLE BUTTON
     ============================================== */
  .header .nav-toggle {
    display: flex !important;
    position: absolute !important;
    right: 24px !important;
    top: 50% !important;
    transform: translateY(-50%) !important;
    z-index: 2147483647 !important;
    background: none !important;
    border: none !important;
    border-radius: 0 !important;
    padding: 0 !important;
    margin: 0 !important;
    width: 48px !important;
    height: 48px !important;
    align-items: center !important;
    justify-content: center !important;
    cursor: pointer !important;
    color: var(--color-text-primary, #161616) !important;
  }

  .header .nav-toggle:hover,
  .header .nav-toggle:focus,
  .header .nav-toggle:active {
    background: transparent !important;
    border: none !important;
    outline: none !important;
    box-shadow: none !important;
  }

  /* Toggle icon states */
  .header .nav-toggle[aria-expanded="true"] .nav-toggle-icon {
    display: none !important;
  }

  .header .nav-toggle[aria-expanded="true"] .nav-toggle-close {
    display: block !important;
  }

  /* SVG color */
  .header .nav-toggle svg {
    color: var(--color-text-primary, #161616) !important;
    fill: currentColor !important;
  }

  /* ==============================================
     RESPONSIVE BEHAVIOR
     ============================================== */
  /* Default: Hide desktop menu, show mobile toggle */
  .header .nav-menu-desktop {
    display: none !important;
  }

  .header .nav-menu-mobile {
    display: none !important;
  }

  /* Mobile menu active state */
  .header .nav-menu-mobile.is-active {
    display: block !important;
    visibility: visible !important;
    opacity: 1 !important;
  }

  /* Mobile: 0-767px */
  @media (max-width: 767px) {
    .header .nav-container {
      padding: 6px 16px !important;
    }
    .header .nav-wrapper {
      padding: 0 !important;
      min-height: 52px !important;
    }
    .header .nav-menu-desktop {
      display: none !important;
    }
    .header .nav-toggle {
      display: flex !important;
    }
    .header .nav-menu-mobile {
      display: none !important;
    }
    .header .nav-menu-mobile.is-active {
      display: block !important;
    }
  }

  /* Tablet: 768px-1023px */
  @media (min-width: 768px) and (max-width: 1023px) {
    .header .nav-container {
      padding: 6px 16px !important;
    }
    .header .nav-wrapper {
      padding: 0 !important;
      min-height: 52px !important;
    }
    .header .nav-menu-desktop {
      display: none !important;
    }
    .header .nav-toggle {
      display: flex !important;
    }
    .header .nav-menu-mobile {
      display: none !important;
    }
    .header .nav-menu-mobile.is-active {
      display: block !important;
    }
  }

  /* Desktop: 1024px+ */
  @media (min-width: 1024px) {
    .header .nav-container {
      padding: 0 24px !important;
    }
    .header .nav-wrapper {
      padding: 16px 0 !important;
      min-height: 72px !important;
    }
    .header .nav-menu-desktop {
      display: block !important;
    }
    /* Force hide mobile elements on desktop */
    .header .nav-toggle {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
      pointer-events: none !important;
    }
    .header .nav-menu-mobile,
    .header .nav-menu-mobile.is-active {
      display: none !important;
      visibility: hidden !important;
      opacity: 0 !important;
    }
  }

  @media (min-width: 1460px) {
    .header .nav-container {
      padding: 0 24px !important;
    }
  }

  /* ==============================================
     Z-INDEX MANAGEMENT
     ============================================== */
  .hs-tools-menu,
  .hs-tools-menu.hs-collapsed,
  .hs-tools-menu.hs-expanded {
    z-index: 999998 !important;
  }

  .header .nav-toggle {
    z-index: 2147483647 !important;
  }

  .header .nav-menu-mobile {
    z-index: 999999 !important;
  }

</style>

<script>
(function() {
  'use strict';

  function initHeaderNavigation() {
    // ===== MOBILE MENU TOGGLE =====
    const navToggle = document.querySelector('.header .nav-toggle');
    const mobileMenu = document.querySelector('.header .nav-menu-mobile');

    if (navToggle && mobileMenu) {
      // Use capture phase to run BEFORE template_child.js handler
      navToggle.addEventListener('click', function(e) {
        // Stop other handlers from running
        e.stopImmediatePropagation();
        e.preventDefault();

        const isExpanded = this.getAttribute('aria-expanded') === 'true';

        if (isExpanded) {
          this.setAttribute('aria-expanded', 'false');
          mobileMenu.classList.remove('is-active');
        } else {
          this.setAttribute('aria-expanded', 'true');
          mobileMenu.classList.add('is-active');
        }
      }, true); // Capture phase ensures our handler runs first
    }

    // ===== MOBILE SUBMENU TOGGLE =====
    const mobileMenuItems = document.querySelectorAll('.header .nav-mobile-item.has-submenu');

    mobileMenuItems.forEach(item => {
      const link = item.querySelector('.nav-mobile-link.has-children');

      if (link) {
        link.addEventListener('click', function(e) {
          // Only prevent default if this link has children
          if (item.classList.contains('has-submenu')) {
            e.preventDefault();
            e.stopPropagation();

            // Toggle submenu open/close
            if (item.classList.contains('submenu-open')) {
              item.classList.remove('submenu-open');
            } else {
              // Close other open submenus
              mobileMenuItems.forEach(otherItem => {
                if (otherItem !== item) {
                  otherItem.classList.remove('submenu-open');
                }
              });
              item.classList.add('submenu-open');
            }
          }
        });
      }
    });

    // ===== CLOSE MOBILE MENU ON OUTSIDE CLICK =====
    document.addEventListener('click', function(event) {
      if (mobileMenu && mobileMenu.classList.contains('is-active')) {
        const clickedInsideMenu = mobileMenu.contains(event.target);
        const clickedToggle = navToggle && navToggle.contains(event.target);

        if (!clickedInsideMenu && !clickedToggle) {
          mobileMenu.classList.remove('is-active');
          if (navToggle) {
            navToggle.setAttribute('aria-expanded', 'false');
          }
        }
      }
    });
  }

  // Initialize when DOM is ready
  if (document.readyState === 'loading') {
    document.addEventListener('DOMContentLoaded', initHeaderNavigation);
  } else {
    // DOM already loaded
    initHeaderNavigation();
  }
})();
</script>
